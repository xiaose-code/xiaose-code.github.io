(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{466:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"usbguard项目编译环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usbguard项目编译环境配置"}},[s._v("#")]),s._v(" USBGUARD项目编译环境配置")]),s._v(" "),a("h1",{attrs:{id:"_1-主要目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-主要目录结构"}},[s._v("#")]),s._v(" 1. 主要目录结构")]),s._v(" "),a("div",{staticClass:"language-pascal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-pascal"}},[a("code",[s._v("kylin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("kylinV10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("项目搭建在根目录下的data目录里"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\ndata\n│   \n├── tq_usb\n│   ├── thirdparty（三方库目录）\n│\t│   ├── build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│\t│   ├── libhv_new（libhv 第三方库）\n│\t│   ├── libqb\n│\t│   ├── libsodium\n│\t│   ├── libxml2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n│\t│   ├── openssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("g\n│\t│   ├── protobuf\n│\t│   ├── util"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("linux"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("smxa\n│\t│   └── xz"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("（lzma 第三方库）\n│   ├── make_package"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("制作安装包的目录"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n│\t│   ├── 安装注意事项"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt\n│\t│   ├── config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n│\t│   ├── copy_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh（拷贝文件脚本）\n│\t│   ├── Packager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py（制作安装包的脚本）\n│\t│   └── res\n│   ├── usbdesktop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("编译桌面程序"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n│\t│   ├── build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│\t│   ├── run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│\t├── power_reg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("编译注册程序"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n│   ├── usbguard\n│   │\t├── autogen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│   │\t└── init_build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh（）\n├── lost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("found\n├── root\n└── usershare\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h1",{attrs:{id:"_2-编译项目前的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译项目前的配置"}},[s._v("#")]),s._v(" 2. 编译项目前的配置")]),s._v(" "),a("p",[s._v("运行第三方库脚本安装前的前置条件：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libdbus-1-dev\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libpolkit-gobject-1-dev\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libglib2.0-dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h1",{attrs:{id:"_3-运行第三方库的脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-运行第三方库的脚本"}},[s._v("#")]),s._v(" 3. 运行第三方库的脚本")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/data/tq_usb/thirdparty")]),s._v("路径下找到"),a("code",[s._v("build.sh")]),s._v("脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/thirdparty\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1704865561035","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1704865561035.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("执行以下命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最新版可以一键编译")]),s._v("\n./build.sh x86_64 kylin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kylin x86_64 环境用以下命令")]),s._v("\n./build.sh x86_64 kylin lzma\n./build.sh x86_64 kylin xml2\n./build.sh x86_64 kylin qb\n./build.sh x86_64 kylin protobuf\n./build.sh x86_64 kylin sodium\n./build.sh x86_64 kylin hv\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kylin aarch64 环境用以下命令")]),s._v("\n./build.sh aarch64 kylin lzma\n./build.sh aarch64 kylin xml2\n./build.sh aarch64 kylin qb\n./build.sh aarch64 kylin protobuf\n./build.sh aarch64 kylin sodium\n./build.sh aarch64 kylin hv\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# UOS mips 环境用以下命令")]),s._v("\n./build.sh mips UOS lzma\n./build.sh mips UOS xml2\n./build.sh mips UOS qb\n./build.sh mips UOS protobuf\n./build.sh mips UOS sodium\n./build.sh mips UOS hv\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h2",{attrs:{id:"_3-1-缺少-automake-1-16-包的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-缺少-automake-1-16-包的问题"}},[s._v("#")]),s._v(" 3.1 缺少 automake-1.16 包的问题")]),s._v(" "),a("p",[s._v("执行脚本有可能会报缺少 automake-1.16")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1704865976223","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1704865976223.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("表明在尝试编译 xz-5.2.5 这个软件包时，automake-1.16 工具没有在您的系统上找到。automake 是 GNU Automake 包的一部分，它用于生成 Makefile.in 文件，这是由 autoconf 用于生成最终 Makefile 的基础文件。"),a("strong",[s._v("要解决这个问题，需要安装 GNU Automake 包以及它的依赖项。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" automake autoconf2.13 m4 perl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-2-no-package-libxml-2-0-found-的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-no-package-libxml-2-0-found-的问题"}},[s._v("#")]),s._v(" 3.2 No package 'libxml-2.0' found 的问题")]),s._v(" "),a("p",[s._v("如果执行 "),a("code",[s._v("./build.sh x86_64 kylin")]),s._v(" 脚本命令出现如下错误，就往 3.3 步骤继续走")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705312293484","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705312293484.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-3-undefined-macro-ac-msg-error-的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-undefined-macro-ac-msg-error-的问题"}},[s._v("#")]),s._v(" 3.3 undefined macro : AC MSG_ERROR 的问题")]),s._v(" "),a("p",[s._v("就找到每一个库，进入该第三方库就行单独编译，"),a("code",[s._v("./autogen.sh")]),s._v(" 脚本，如果还出现以下错误")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705368449552","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705368449552.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入以下命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" autoconf-archive\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("出现如下图所示就表示编译通过")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705369028548","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705369028548.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("如果还无法解决可以参考这个链接的内容：https://www.thinbug.com/q/8811381")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-4-no-xxx-三方库的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-no-xxx-三方库的问题"}},[s._v("#")]),s._v(" 3.4 No xxx 三方库的问题")]),s._v(" "),a("p",[s._v("如果执行 "),a("code",[s._v("./build.sh x86_64 kylin")]),s._v(" 脚本命令出现错误，就一个库一个库编译，比如编译 lzma(即 xz-5.2.5)库 "),a("code",[s._v("./build.sh x86_64 kylin lzma")]),s._v(" 出现无法找到的问题，进入该三方库 "),a("code",[s._v("cd xz-5.2.5")]),s._v("，创建一个 "),a("code",[s._v("do_build")]),s._v(" 目录，在返回上一级目录，重新编译 "),a("code",[s._v("./build.sh x86_64 kylin lzma")]),s._v(" 命令就可以了")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705369475951","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705369475951.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("第三方库都安装完成就可以进行下一步编译项目源码")]),s._v(" "),a("h1",{attrs:{id:"_4-编译项目源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-编译项目源码"}},[s._v("#")]),s._v(" 4. 编译项目源码")]),s._v(" "),a("h2",{attrs:{id:"_4-1-编译后台程序-usbguard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-编译后台程序-usbguard"}},[s._v("#")]),s._v(" 4.1 编译后台程序 usbguard")]),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/usbguard")]),s._v(" 目录，创建 "),a("code",[s._v("do_build")]),s._v(" 目录，有的话就不用创建，直接清空就行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# usbguard 目录没有 do_build 目录就创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" do_build\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有的话就清空")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" *\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/autogen.sh\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/init_build.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("在 "),a("code",[s._v("do_build")]),s._v(" 目录执行完 "),a("code",[s._v("../configure")]),s._v(" 后如果出现以下错误：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705371397466","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705371397466.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/lib/pkgconfig")]),s._v(" 查看是否有 "),a("code",[s._v("libhv.pc")]),s._v(" 文件，其他三方库也在这里")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705383471608","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705383471608.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("如果没有，则需要 ssh 远程连接其他终端上通过内网拉取，拷贝到这个目录，然后修改路径 "),a("code",[s._v("sudo vim libhv.pc")]),s._v(" 其他三方库出现这个问题也一样。如下路所示，把下图的 prefix 的路径改为自己项目所在的路径")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705383662795","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705383662795.webp",loading:"lazy"}})]),s._v(" "),a("p",[a("strong",[s._v("最后就在 "),a("code",[s._v("do_build")]),s._v(" 目录继续进行 4.1 步骤")]),s._v("，就会生成如下几个可执行文件和配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接着执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705389726815","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705389726815.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("编译过程如果无报错则继续往下走，有报错，则自行根据具体报错解决。")]),s._v(" "),a("h2",{attrs:{id:"_4-2-编译桌面程序-usbdesk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-编译桌面程序-usbdesk"}},[s._v("#")]),s._v(" 4.2 编译桌面程序 usbdesk")]),s._v(" "),a("p",[s._v("运行脚本前先看看路径，因为不同终端的编译路径可能会不一样。（改 CMakeList.txt 文件）")]),s._v(" "),a("p",[s._v("这个是 "),a("code",[s._v("/data/tq_usb/usbdesktop/")]),s._v(" 目录下的 "),a("code",[s._v("run.sh")]),s._v(" 文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705386595330","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705386595330.webp",loading:"lazy"}})]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1706669251810","data-src":"https://jsd.cdn.zzko.cn/gh/xiaose-code/Pictures@main/img/1706669251810.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("这里修改的原因可以对照 ``/data/tq_usb/usbdesktop` main.cpp")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("在看看"),a("code",[s._v("/data/tq_usb/usbdesktop/")]),s._v(" 目录下的 "),a("code",[s._v("build.sh")]),s._v(" 文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705386997129","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705386997129.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("在看看"),a("code",[s._v("/data/tq_usb/usbdesktop/")]),s._v(" 目录下的 "),a("code",[s._v("CMakeList.txt")]),s._v(" 文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705651273840","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705651273840.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/usbdesktop/do_build")]),s._v(" 目录，运行 "),a("code",[s._v("build.sh")]),s._v(" 和 "),a("code",[s._v("run.sh")]),s._v(" 脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# usbdesktop 目录没有 do_build 目录就创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" do_build\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有的话就清空")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" *\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop/do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/build.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j8")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("笔者这里运行 "),a("code",[s._v("build.sh")]),s._v(" 脚本是因为缺少了 qt5 的部分组件，所以报错了，有类似的朋友可以参考")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705387325407","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705387325407.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接命令行下载（前提是你的QT5也是用命令行下载的）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" qttools5-dev-tools\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有解决就把 多余的 QT安装包删了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" remove qttools5-dev-tools\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后你会看到他叫你可以删除多余的不需要的安装包，都删了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" autoremove\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后再重新下载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" qttools5-dev-tools\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("删除多余的安装包，如下图：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705389373449","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705389373449.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("编译成功，如下图：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705389058070","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705389058070.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("然后接着继续编译源码，还是在 "),a("code",[s._v("do_build")]),s._v(" 目录执行 "),a("code",[s._v("make install -j8")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j8")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后在 "),a("code",[s._v("do_build")]),s._v(" 目录就生成了桌面程序 "),a("code",[s._v("usbdesk")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705389619953","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705389619953.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_4-3-编译注册程序-power-reg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-编译注册程序-power-reg"}},[s._v("#")]),s._v(" 4.3 编译注册程序 power_reg")]),s._v(" "),a("p",[s._v("同样先进入脚本查看路径，因为这个是 QT 编写的程序，所以这里的脚本应该是以 "),a("code",[s._v(".pro")]),s._v(" 结尾的文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705390104544","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705390104544.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" prower_reg.pro\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705390193134","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705390193134.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("这里该不该都行，因为框框中的路径是被注释了的，改掉只是为了统一好看点。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/power_reg/do_build")]),s._v(" 目录，执行 "),a("code",[s._v("qmake ..")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# power_reg 目录没有 do_build 目录就创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/power_reg/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" do_build\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有的话就清空")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" *\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\nqmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n---------------------如下：---------------------------------------------\nkylin@kylin:/data/tq_usb/power_reg/do_build$ qmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nInfo: creating stash "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /data/tq_usb/power_reg/do_build/.qmake.stash\nProject MESSAGE: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VAR_OS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kylin\nProject MESSAGE: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VAR_OS_VER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v10\nProject MESSAGE: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x86_64\n------------------------------------------------------------------------\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行完毕后就会在")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/tq_usb/release/x86_64/kylin-v10/bin 这个目录下生成 可执行文件 PowerReg")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h2",{attrs:{id:"_4-4-单机版本地运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-单机版本地运行"}},[s._v("#")]),s._v(" 4.4 单机版本地运行")]),s._v(" "),a("blockquote",[a("p",[s._v("项目源码编译通过再按下面步骤走")])]),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/usbguard/src/DBus/")]),s._v(" 目录，将 "),a("code",[s._v("org.usbguard1.policy")]),s._v(" 文件中的所有 "),a("code",[s._v("auth_admin")]),s._v(" 该为 yes")]),s._v(" "),a("blockquote",[a("p",[s._v("这里介绍一个快捷的方式：vim 的手动批量替换（可以防止一键自动替换错地方）")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("首先，我们需要找到我们想要替换的文字。通过在普通模式下按"),a("code",[s._v("/")]),s._v("键并输入我们想要搜索的词语，Vim 就会高亮显示出所有文档中匹配该词语的地方，按下"),a("code",[s._v("Enter")]),s._v("键以确定搜索。")])]),s._v(" "),a("li",[a("p",[s._v("然后通过"),a("code",[s._v("n")]),s._v("和"),a("code",[s._v("N")]),s._v("键在搜索结果中向前和向后跳转。"),a("code",[s._v("n")]),s._v("键会将光标移动到下一个搜索结果，"),a("code",[s._v("N")]),s._v("键则会将光标移动到上一个搜索结果。")])]),s._v(" "),a("li",[a("p",[s._v("当我们找到了要替换的词语，我们可以通过"),a("code",[s._v("cw")]),s._v("命令将该词语替换为新的词语。在普通模式下，"),a("code",[s._v("cw")]),s._v("命令将删除从光标位置开始的词语，并进入插入模式，这允许我们输入新的词语。当我们完成新词语的输入后，通过按"),a("code",[s._v("Esc")]),s._v("键返回到普通模式。")])]),s._v(" "),a("li",[a("p",[s._v("如果我们想要重复上一步的替换操作，我们可以简单地通过"),a("code",[s._v(".")]),s._v("命令来实现。在普通模式下，"),a("code",[s._v(".")]),s._v("命令将重复最后一次修改，这也包括了我们的替换操作。")])]),s._v(" "),a("li",[a("p",[s._v("通过重复步骤 2 至 4，我们就可以实现对文档中所有匹配的词语的替换。")]),s._v(" "),a("p",[s._v("这就是在 Vim 中完成批量替换操作的步骤。尽管最开始可能会觉得有些复杂，但是一旦熟练掌握，你就会发现这实际上是一个非常快速和高效的替换方法。")])])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/src/DBus/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" org.usbguard1.policy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705394377574","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705394377574.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("例如：框框中的 auto_admin（不止这两个地方）改为 yes")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705394697922","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705394697922.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("/data/tq_usb/usbguard/src/DBus/org.usbguard1.policy")]),s._v(" 拷贝到 "),a("code",[s._v("/usr/share/polkit-1/actions/")])]),s._v(" "),a("p",[s._v("同时将 "),a("code",[s._v("/data/tq_usb/usbguard/src/DBus/org.usbguard1.conf")]),s._v(" 拷贝到  "),a("code",[s._v("/usr/share/dbus-1/system.d")]),s._v(" 下")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1704867038990","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1704867038990.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 /data/tq_usb/usbguard/src/DBus 目录下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/src/DBus\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" org.usbguard1.policy /usr/share/polkit-1/actions/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" org.usbguard1.conf /usr/share/dbus-1/system.d\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者是在 /usr/share/polkit-1/actions/ 目录下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/polkit-1/actions/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/usbguard/src/DBus/org.usbguard1.policy "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/dbus-1/system.d/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/usbguard/src/DBus/org.usbguard1.conf "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("然后将 "),a("code",[s._v("/data/tq_usb/usbdesktop/etc")]),s._v(" 目录下的 usbdesk.conf 文件中的进行修改")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop/etc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1708329835016","data-src":"https://jsd.cdn.zzko.cn/gh/xiaose-code/Pictures@main/img/1708329835016.webp",loading:"lazy"}})]),s._v(" "),a("h2",{attrs:{id:"_4-5-运行项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-运行项目"}},[s._v("#")]),s._v(" 4.5 运行项目")]),s._v(" "),a("p",[s._v("把 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/etc")]),s._v(" 目录下的 usbguard 配置文件拷贝到 /etc 目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/etc/usbguard "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705395494488","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705395494488.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行项目之前要先在 /data/tq_usb/usbguard/do_build/.libs 目录下执行配置文件，不然会把鼠标键盘全部禁用掉，就要重新开机了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/do_build/.libs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard generate-policy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /etc/usbguard/usbguard-daemon.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首先进入 do_build 下的隐藏目录 .libs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/do_build/.libs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard-daemon "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新开一个标签,返回 do_build 目录，执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard-dbus "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再新开一个标签，是在 /data/tq_usb/usbdesktop 目录，执行")]),s._v("\n./run.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("在执行 "),a("code",[s._v("sudo ./usbguard-daemon")]),s._v(" 时出现找不到某个共享库"),a("img",{staticClass:"lazy",attrs:{alt:"1705395899224","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705395899224.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("要把 "),a("code",[s._v("/data/tq_usb/usbguard/do_build/.libs")]),s._v(" 目录和 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/lib")]),s._v(" 第三方库这两个路径加入到 "),a("code",[s._v("/etc/ld.so.conf.d/libc.conf")]),s._v(" 文件里")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/ld.so.conf.d/libc.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705397511285","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705397511285.webp",loading:"lazy"}})]),s._v(" "),a("h1",{attrs:{id:"_5-打包成安装包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-打包成安装包"}},[s._v("#")]),s._v(" 5. 打包成安装包")]),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/lib")]),s._v(" 整个目录 copy 到 "),a("code",[s._v("/data/tq_usb/make_package/res/lib")]),s._v("目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/lib/ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/sbin/usbguard-daemon")]),s._v(" 和 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/sbin/usbguard-dbus")]),s._v(" 两个文件 copy 到 "),a("code",[s._v("/data/tq_usb/make_package/res/bin/")]),s._v("目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/make_package/res/bin\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/sbin/usbguard-daemon "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/sbin/usbguard-dbus "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705391414379","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705391414379.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/bin")]),s._v(" 目录下的 PowerReg、usbdesk、usbguard 三个文件\ncopy 到 "),a("code",[s._v("/data/tq_usb/make_package/res/bin")]),s._v(" 目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/bin/PowerReg "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/bin/usbdesk "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/bin/usbguard "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705393378879","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705393378879.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("到 "),a("code",[s._v("/data/tq_usb/make_package")]),s._v(" 目录下找到 "),a("code",[s._v("Packager.py")]),s._v(" 脚本执行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./Packager.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输入版本号, 就会自动生成deb安装包")]),s._v(" "),a("p",[s._v("第一次打包可能告诉你需要下载某个东西")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705393496704","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705393496704.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" dh-make devscripts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("再次执行脚本")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705393858017","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705393858017.webp",loading:"lazy"}})]),s._v(" "),a("blockquote",[a("p",[s._v("不知道是不是 bug，这里要敲击 "),a("code",[s._v("ctrl+C")]),s._v(" 程序才会继续运行，不然就会一直卡在这里。")])]),s._v(" "),a("p",[s._v("安装完后的安装包就是一个以 "),a("code",[s._v(".deb")]),s._v(" 结尾的文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705393980638","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705393980638.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("安装这个包可以执行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" com.tq.usbguard_2024.1.16_amd64.deb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果后续要换版本了，不需要这个安装包，想重新打包，需要把 build 目录里的文件全部删除，然后在重新打包")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" build/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"_6-安装过程注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-安装过程注意事项"}},[s._v("#")]),s._v(" 6. 安装过程注意事项")]),s._v(" "),a("ol",[a("li",[s._v("安装之前把所有的u盘拨出")]),s._v(" "),a("li",[s._v("插好 USB 接口的鼠标和键盘")]),s._v(" "),a("li",[s._v("开始安装")]),s._v(" "),a("li",[s._v("首次运行需要等待大约30秒再启动桌面程序")])]),s._v(" "),a("h1",{attrs:{id:"_7-项目解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-项目解读"}},[s._v("#")]),s._v(" 7. 项目解读")]),s._v(" "),a("h2",{attrs:{id:"_7-1-usb-规则类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-usb-规则类型"}},[s._v("#")]),s._v(" 7.1 USB 规则类型")]),s._v(" "),a("p",[s._v("每个 USB 设备有三种类型的目标规则:")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("allow")]),s._v(" – 授权 USB 设备")]),s._v(" "),a("li",[a("strong",[s._v("block")]),s._v(" – 不授权 USB 设备，但是系统仍然可以使用 lsusb 命令看到（可见）该设备。但是，用户不能使用 USB 设备，因为在系统管理员授权之前，它一直处于被阻止状态。（阻止设备）")]),s._v(" "),a("li",[a("strong",[s._v("reject")]),s._v(" – 不授权 USB 设备，该设备对系统或用户不可见。USB设备需要再次重新插入才能再次可见。（拒绝该设备）")])]),s._v(" "),a("h2",{attrs:{id:"_7-2-了解-etc-usbguard-usbguard-daemon-conf-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-了解-etc-usbguard-usbguard-daemon-conf-配置"}},[s._v("#")]),s._v(" 7.2 了解 /etc/usbguard/usbguard-daemon.conf 配置")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1706168371028","data-src":"https://jsd.cdn.zzko.cn/gh/xiaose-code/Pictures@main/img/1706168371028.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我们使用 less 查看文件发现很多东西，难以观察")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("less")]),s._v(" usbguard-daemon.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以我们要进行筛选")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-vE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^#|^$'")]),s._v(" /etc/usbguard/usbguard-daemon.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个命令主要是在 /etc/usbguard/usbguard-daemon.conf 配置文件中找出并显示所有非注释和非空行。")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1706168542426","data-src":"https://jsd.cdn.zzko.cn/gh/xiaose-code/Pictures@main/img/1706168542426.webp",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[a("code",[s._v("-v")]),s._v("：这是 grep 命令的一个选项，会反转搜索结果，也就是说，它会返回所有“不匹配”搜索模式的行。")]),s._v(" "),a("li",[a("code",[s._v("-E")]),s._v("：这是 grep 命令的一个选项，用于支持扩展的正则表达式。")]),s._v(" "),a("li",[a("code",[s._v("'^#|^$'")]),s._v(": 这是 grep 要搜索的模式。它是一个正则表达式，用于匹配以 "),a("code",[s._v("#")]),s._v(" 开头的行（也就是注解行）或空行。 "),a("code",[s._v("^")]),s._v(" 是一种定位符，表示行的开始，"),a("code",[s._v("|")]),s._v(" 是 “或”的意思，表示符号前后的任何一个条件满足即可。")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("名称")]),s._v(" "),a("th",[s._v("解释")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("RuleFile (规则文件)")]),s._v(" "),a("td",[s._v("USBGuard 守护程序将使用该文件加载策略规则集，并写入通过 IPC 接口接收的新规则。")])]),s._v(" "),a("tr",[a("td",[s._v("ImplicitPolicyTarget (隐式策略目标)")]),s._v(" "),a("td",[s._v("如何对待与策略中的任何规则都不匹配的 USB 设备。目标应为允许、阻止或拒绝之一（从系统中逻辑删除设备节点）。")])]),s._v(" "),a("tr",[a("td",[s._v("PresentDevicePolicy (当前设备策略)")]),s._v(" "),a("td",[s._v("如何对待守护进程启动时已经连接的 USB 设备？策略应为允许、阻止、拒绝、保持（保持设备当前的状态）或应用策略（评估每个现有设备的规则集）之一。")])]),s._v(" "),a("tr",[a("td",[s._v("PresentControllerPolicy (当前控制策略)")]),s._v(" "),a("td",[s._v("如何处理守护程序启动时已经连接的 USB 控制器设备。允许、阻止、拒绝、保留或应用策略之一。")])]),s._v(" "),a("tr",[a("td",[s._v("InsertedDevicePolicy (插入的设备策略)")]),s._v(" "),a("td",[s._v("如何对待守护进程启动后已经连接的 USB 设备？阻止、拒绝、应用策略之一。")])]),s._v(" "),a("tr",[a("td",[s._v("RestoreControllerDeviceState (还原控制器设备状态)")]),s._v(" "),a("td",[s._v("USBGuard 守护程序修改控制器设备的某些属性，如新的子设备实例的默认授权状态。使用此设置，您可以控制守护程序在关机时是否尝试将属性值恢复到修改前的状态。")])]),s._v(" "),a("tr",[a("td",[s._v("DeviceManagerBackend (设备管理器备份)")]),s._v(" "),a("td",[s._v("使用哪个设备管理器后端实现。后端应为 uevent（默认）或umockdev 之一。")])]),s._v(" "),a("tr",[a("td",[s._v("IPCAllowedUsers (IPC 允许的用户)")]),s._v(" "),a("td",[s._v("守护程序将接受 IPC 连接的用户名的空格分隔列表。")])]),s._v(" "),a("tr",[a("td",[s._v("IPCAllowedGroups (IPC 允许的组)")]),s._v(" "),a("td",[s._v("守护程序将从其接受 IPC 连接的以空格分隔的组名列表。")])]),s._v(" "),a("tr",[a("td",[s._v("IPCAccessControlFiles (IPC 访问控制文件)")]),s._v(" "),a("td",[s._v("守护程序会将此位置的文件解释为 IPC 访问控制定义文件。详情参见 IPC 访问控制部分。")])]),s._v(" "),a("tr",[a("td",[s._v("DeviceRulesWithPort (带有端口的设备规则)")]),s._v(" "),a("td",[s._v("生成包括“通过端口”属性的设备特定规则。")])]),s._v(" "),a("tr",[a("td",[s._v("AuditBackend (审计后端)")]),s._v(" "),a("td",[s._v("USBGuard 审核事件日志后端。后端值应为 FileAudit 或LinuxAudit 之一。")])]),s._v(" "),a("tr",[a("td",[s._v("AuditFilePath (审计文件路径)")]),s._v(" "),a("td",[s._v("USBGuard 审核事件日志文件路径。如果 AuditBackend 设置为FileAudit，则需要此选项。")])])])]),s._v(" "),a("h2",{attrs:{id:"_7-3-列出-usbguard-守护程序使用的规则集-策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-列出-usbguard-守护程序使用的规则集-策略"}},[s._v("#")]),s._v(" 7.3 列出 USBGuard 守护程序使用的规则集（策略）")]),s._v(" "),a("blockquote",[a("p",[s._v("按照 4.4 部分启动程序后")]),s._v(" "),a("p",[s._v("在 /data/tq_usb/usbguard/do_build/.libs 目录下执行后续命令")])]),s._v(" "),a("h3",{attrs:{id:"_7-3-1-使用以下命令可以列出规则集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-1-使用以下命令可以列出规则集"}},[s._v("#")]),s._v(" 7.3.1 使用以下命令可以列出规则集：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard list-rules\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1706170787626","data-src":"https://jsd.cdn.zzko.cn/gh/xiaose-code/Pictures@main/img/1706170787626.webp",loading:"lazy"}})]),s._v(" "),a("h3",{attrs:{id:"_7-3-2-显示受特定规则影响的所有设备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-2-显示受特定规则影响的所有设备"}},[s._v("#")]),s._v(" 7.3.2 显示受特定规则影响的所有设备")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" usbguard list-rules "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1706170901405","data-src":"https://jsd.cdn.zzko.cn/gh/xiaose-code/Pictures@main/img/1706170901405.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" usbguard list-rules --show-devices\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"image-20240125162233168","data-src":"C:%5CUsers%5Ctq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240125162233168.png",loading:"lazy"}})]),s._v(" "),a("h3",{attrs:{id:"_7-3-3-还可以显示具有特定标签的规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-3-还可以显示具有特定标签的规则"}},[s._v("#")]),s._v(" 7.3.3 还可以显示具有特定标签的规则")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard list-rules "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("label_here"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard list-rules "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--label")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_7-3-4-列出-usbguard-守护程序识别的所有-usb-设备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-4-列出-usbguard-守护程序识别的所有-usb-设备"}},[s._v("#")]),s._v(" 7.3.4 列出 USBGuard 守护程序识别的所有 USB 设备")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo ./usbguard list-devices\nsudo ./usbguard list-devices -a ## list allowed devices ##\nsudo ./usbguard list-devices -b ## list blocked devices ##\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h1",{attrs:{id:"_8-项目测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-项目测试"}},[s._v("#")]),s._v(" 8. 项目测试")]),s._v(" "),a("h2",{attrs:{id:"_8-1-测试-usb-插入是否默认阻止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-测试-usb-插入是否默认阻止"}},[s._v("#")]),s._v(" 8.1 测试 USB 插入是否默认阻止")]),s._v(" "),a("p",[s._v("我将插入我的USB 4G LTE调制解调器，查看它是否被默认阻止并运行 lsusb:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("lsusb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("示例输出表明华为USB连接到USB端口（设备009: ID 12d1:157c）并且对系统可见:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Bus 004 Device 002: ID 2109:0813 VIA Labs, Inc. USB3.0 Hub\nBus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub\nBus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\nBus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub\nBus 001 Device 004: ID 06cb:00bd Synaptics, Inc. \nBus 001 Device 007: ID 2109:0102 VIA Labs, Inc. Microsoft Ergonomic Keyboard\nBus 001 Device 005: ID 1a40:0101 Terminus Technology Inc. Hub\nBus 001 Device 003: ID 2109:2813 VIA Labs, Inc. USB2.0 Hub\nBus 001 Device 009: ID 12d1:157c Huawei Technologies Co., Ltd. HUAWEI_MOBILE\nBus 001 Device 006: ID 8087:0029 Intel Corp. \nBus 001 Device 002: ID 045e:082c Microsoft Corp. Microsoft Ergonomic Keyboard\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("但是，该设备被 USBGuard 阻止。您将看到内核消息，指示华为 USB 设备未经授权使用，如下所示:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'authorized'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("示例输出表明默认情况下 USBGuard 会阻止 USB 调制解调器:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[87467.670280] usb 1-2: new high-speed USB device number 8 using xhci_hcd\n[87467.820572] usb 1-2: New USB device found, idVendor=12d1, idProduct=157c, bcdDevice= 1.02\n[87467.820578] usb 1-2: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[87467.820581] usb 1-2: Product: HUAWEI_MOBILE\n[87467.820584] usb 1-2: Manufacturer: HUAWEI_MOBILE\n[87467.820587] usb 1-2: SerialNumber: 0123456789ABCDEF\n[87467.820928] usb 1-2: Device is not authorized for usage\n[87477.196260] usb 1-2: USB disconnect, device number 8\n[87477.682044] usb 1-2: new high-speed USB device number 9 using xhci_hcd\n[87477.831578] usb 1-2: New USB device found, idVendor=12d1, idProduct=157c, bcdDevice= 1.02\n[87477.831583] usb 1-2: New USB device strings: Mfr=1, Product=2, SerialNumber=3\n[87477.831587] usb 1-2: Product: HUAWEI_MOBILE\n[87477.831590] usb 1-2: Manufacturer: HUAWEI_MOBILE\n[87477.831593] usb 1-2: SerialNumber: 0123456789ABCDEF\n[87477.831931] usb 1-2: Device is not authorized for usage\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("我们可以使用以下命令查看被阻止的 USB 设备:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard list-devices "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输出：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('24: block id 12d1:157c serial "0123456789ABCDEF" name "HUAWEI_MOBILE" hash "8tSOgfYNylANtACo0ysV5qRAx5Ht+geWMd+QOVNcK70=" parent-hash "jEP/6WzviqdJ5VSeTUY8PatCNBKeaREvo2OqdplND/o=" via-port "1-2" with-interface { 08:06:50 02:0e:00 0a:00:02 0a:00:02 08:06:50 } with-connect-type "hotplug"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中数据块的目标策略如下:")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("24")]),s._v(" – 设备号")]),s._v(" "),a("li",[s._v("**block id 12d1:157c ** – USB 设备 ID")]),s._v(" "),a("li",[a("strong",[s._v('serial "0123456789ABCDEF"')]),s._v(" – USB 设备序列号")]),s._v(" "),a("li",[a("strong",[s._v('name "HUAWEI_MOBILE"')]),s._v(" – USB 设备名称")])]),s._v(" "),a("blockquote",[a("p",[s._v("USB 设备号是动态生成的，在你的 Linux 系统中会有所不同。")])]),s._v(" "),a("h2",{attrs:{id:"_8-2-暂时允许访问-usb-设备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-暂时允许访问-usb-设备"}},[s._v("#")]),s._v(" 8.2 暂时允许访问 USB 设备")]),s._v(" "),a("p",[s._v("默认情况下，我们知道 USBGuard 会阻止连接的USB设备，并将永远被禁止。这意味着基于 USB 的攻击被阻止。但是，如果我想访问合法的 USB 设备呢？尝试以下命令更改数据块策略以允许使用设备块 ID 为12d1:157c 的设备 # 24:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo ./usbguard allow-device {device_ID}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard allow-device "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("还可以使用如下规则:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard allow-device "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12d1:157c serial \"0123456789ABCDEF\"'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard allow-device "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12d1:1506 serial \"0123456789ABCDEF\"'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_8-3-永久规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-永久规则"}},[s._v("#")]),s._v(" 8.3 永久规则")]),s._v(" "),a("p",[s._v("我们可以让这个决定永久化。特定于设备的允许规则将附加到当前策略中:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo ./usbguard allow-device {device_ID} -p")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard allow-device "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("规则代替 ID:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" usbguard allow-device "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12d1:157c serial \"0123456789ABCDEF\"'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" usbguard allow-device "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12d1:1506 serial \"0123456789ABCDEF\"'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("以下是我使用文本编辑器添加到 rules.conf 的规则:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/usbguard/rules.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("附加以下内容")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('allow id 12d1:157c serial "0123456789ABCDEF" name "HUAWEI_MOBILE" hash "8tSOgfYNylANtACo0ysV5qRAx5Ht+geWMd+QOVNcK70=" parent-hash "jEP/6WzviqdJ5VSeTUY8PatCNBKeaREvo2OqdplND/o=" via-port "1-2" with-interface { 08:06:50 02:0e:00 0a:00:02 0a:00:02 08:06:50 } with-connect-type "hotplug"\nallow id 12d1:1506 serial "" name "HUAWEI_MOBILE" hash "1lr2516yYIsSGGyDZrcgBBNJPlzzthtHbpH1SN5E/VA=" parent-hash "jEP/6WzviqdJ5VSeTUY8PatCNBKeaREvo2OqdplND/o=" via-port "1-2" with-interface { ff:02:12 ff:02:01 ff:02:16 ff:02:16 08:06:50 08:06:50 } with-connect-type "hotplug"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("保存并关闭文件。重新启动服务:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo systemctl restart usbguard.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_8-4-检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-检查"}},[s._v("#")]),s._v(" 8.4 检查")]),s._v(" "),a("p",[s._v("添加规则后，USBGurad 将立即允许 USB 设备访问。现在我可以使用 USB LTE 调制解调器连接到互联网或查看 USD disk:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("udisksctl status\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("MODEL                     REVISION  SERIAL               DEVICE\n--------------------------------------------------------------------------\nSAMSUNG MZVLB1T0HBLR-000L7 5M2QEXF7  xyzfooooooooo1       nvme0n1 \nSAMSUNG MZVLB1T0HBLR-000L7 5M2QEXF7  xyzfooooooooo2       nvme1n1 \nHUAWEI TF CARD Storage    2.31      HUAWEI_TF_CARD_Storage-0:0 sda     \nHUAWEI Mass Storage       2.31      HUAWEI_Mass_Storage-0:0 sr0   \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("也不再有错误:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);