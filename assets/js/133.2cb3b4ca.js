(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{466:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"usbguard项目编译环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usbguard项目编译环境配置"}},[s._v("#")]),s._v(" USBGUARD项目编译环境配置")]),s._v(" "),a("h1",{attrs:{id:"_1-主要目录结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-主要目录结构"}},[s._v("#")]),s._v(" 1. 主要目录结构")]),s._v(" "),a("div",{staticClass:"language-pascal line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-pascal"}},[a("code",[s._v("kylin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("@")]),s._v("kylinV10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("项目搭建在根目录下的data目录里"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\ndata\n│   \n├── tq_usb\n│   ├── thirdparty（三方库目录）\n│\t│   ├── build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│\t│   ├── libhv_new（libhv 第三方库）\n│\t│   ├── libqb\n│\t│   ├── libsodium\n│\t│   ├── libxml2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n│\t│   ├── openssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("g\n│\t│   ├── protobuf\n│\t│   ├── util"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("linux"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("smxa\n│\t│   └── xz"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("（lzma 第三方库）\n│   ├── make_package"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("制作安装包的目录"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n│\t│   ├── 安装注意事项"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt\n│\t│   ├── config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n│\t│   ├── copy_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh（拷贝文件脚本）\n│\t│   ├── Packager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py（制作安装包的脚本）\n│\t│   └── res\n│   ├── usbdesktop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("编译桌面程序"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n│\t│   ├── build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│\t│   ├── run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│\t├── power_reg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("编译注册程序"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n│   ├── usbguard\n│   │\t├── autogen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│   │\t└── init_build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh（）\n├── lost"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("found\n├── root\n└── usershare\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h1",{attrs:{id:"_2-编译项目前的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译项目前的配置"}},[s._v("#")]),s._v(" 2. 编译项目前的配置")]),s._v(" "),a("p",[s._v("运行第三方库脚本安装前的前置条件：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libdbus-1-dev\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libpolkit-gobject-1-dev\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libglib2.0-dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h1",{attrs:{id:"_3-运行第三方库的脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-运行第三方库的脚本"}},[s._v("#")]),s._v(" 3. 运行第三方库的脚本")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/data/tq_usb/thirdparty")]),s._v("路径下找到"),a("code",[s._v("build.sh")]),s._v("脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/thirdparty\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1704865561035","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1704865561035.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("执行以下命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最新版可以一键编译")]),s._v("\n./build.sh x86_64 kylin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kylin x86_64 环境用以下命令")]),s._v("\n./build.sh x86_64 kylin lzma\n./build.sh x86_64 kylin xml2\n./build.sh x86_64 kylin qb\n./build.sh x86_64 kylin protobuf\n./build.sh x86_64 kylin sodium\n./build.sh x86_64 kylin hv\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kylin aarch64 环境用以下命令")]),s._v("\n./build.sh aarch64 kylin lzma\n./build.sh aarch64 kylin xml2\n./build.sh aarch64 kylin qb\n./build.sh aarch64 kylin protobuf\n./build.sh aarch64 kylin sodium\n./build.sh aarch64 kylin hv\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# UOS mips 环境用以下命令")]),s._v("\n./build.sh mips UOS lzma\n./build.sh mips UOS xml2\n./build.sh mips UOS qb\n./build.sh mips UOS protobuf\n./build.sh mips UOS sodium\n./build.sh mips UOS hv\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h2",{attrs:{id:"_3-1-缺少-automake-1-16-包的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-缺少-automake-1-16-包的问题"}},[s._v("#")]),s._v(" 3.1 缺少 automake-1.16 包的问题")]),s._v(" "),a("p",[s._v("执行脚本有可能会报缺少 automake-1.16")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1704865976223","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1704865976223.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("表明在尝试编译 xz-5.2.5 这个软件包时，automake-1.16 工具没有在您的系统上找到。automake 是 GNU Automake 包的一部分，它用于生成 Makefile.in 文件，这是由 autoconf 用于生成最终 Makefile 的基础文件。"),a("strong",[s._v("要解决这个问题，需要安装 GNU Automake 包以及它的依赖项。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" automake autoconf2.13 m4 perl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-2-no-package-libxml-2-0-found-的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-no-package-libxml-2-0-found-的问题"}},[s._v("#")]),s._v(" 3.2 No package 'libxml-2.0' found 的问题")]),s._v(" "),a("p",[s._v("如果执行 "),a("code",[s._v("./build.sh x86_64 kylin")]),s._v(" 脚本命令出现如下错误，就往 3.3 步骤继续走")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705312293484","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705312293484.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-3-undefined-macro-ac-msg-error-的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-undefined-macro-ac-msg-error-的问题"}},[s._v("#")]),s._v(" 3.3 undefined macro : AC MSG_ERROR 的问题")]),s._v(" "),a("p",[s._v("就找到每一个库，进入该第三方库就行单独编译，"),a("code",[s._v("./autogen.sh")]),s._v(" 脚本，如果还出现以下错误")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705368449552","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705368449552.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入以下命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" autoconf-archive\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("出现如下图所示就表示编译通过")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705369028548","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705369028548.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("如果还无法解决可以参考这个链接的内容：https://www.thinbug.com/q/8811381")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_3-4-no-xxx-三方库的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-no-xxx-三方库的问题"}},[s._v("#")]),s._v(" 3.4 No xxx 三方库的问题")]),s._v(" "),a("p",[s._v("如果执行 "),a("code",[s._v("./build.sh x86_64 kylin")]),s._v(" 脚本命令出现错误，就一个库一个库编译，比如编译 lzma(即 xz-5.2.5)库 "),a("code",[s._v("./build.sh x86_64 kylin lzma")]),s._v(" 出现无法找到的问题，进入该三方库 "),a("code",[s._v("cd xz-5.2.5")]),s._v("，创建一个 "),a("code",[s._v("do_build")]),s._v(" 目录，在返回上一级目录，重新编译 "),a("code",[s._v("./build.sh x86_64 kylin lzma")]),s._v(" 命令就可以了")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705369475951","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705369475951.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("第三方库都安装完成就可以进行下一步编译项目源码")]),s._v(" "),a("h1",{attrs:{id:"_4-编译项目源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-编译项目源码"}},[s._v("#")]),s._v(" 4. 编译项目源码")]),s._v(" "),a("h2",{attrs:{id:"_4-1-编译后台程序-usbguard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-编译后台程序-usbguard"}},[s._v("#")]),s._v(" 4.1 编译后台程序 usbguard")]),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/usbguard")]),s._v(" 目录，创建 "),a("code",[s._v("do_build")]),s._v(" 目录，有的话就不用创建，直接清空就行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# usbguard 目录没有 do_build 目录就创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" do_build\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有的话就清空")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" *\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/autogen.sh\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/init_build.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("在 "),a("code",[s._v("do_build")]),s._v(" 目录执行完 "),a("code",[s._v("../configure")]),s._v(" 后如果出现以下错误：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705371397466","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705371397466.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/lib/pkgconfig")]),s._v(" 查看是否有 "),a("code",[s._v("libhv.pc")]),s._v(" 文件，其他三方库也在这里")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705383471608","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705383471608.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("如果没有，则需要 ssh 远程连接其他终端上通过内网拉取，拷贝到这个目录，然后修改路径 "),a("code",[s._v("sudo vim libhv.pc")]),s._v(" 其他三方库出现这个问题也一样。如下路所示，把下图的 prefix 的路径改为自己项目所在的路径")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705383662795","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705383662795.webp",loading:"lazy"}})]),s._v(" "),a("p",[a("strong",[s._v("最后就在 "),a("code",[s._v("do_build")]),s._v(" 目录继续进行 4.1 步骤")]),s._v("，就会生成如下几个可执行文件和配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接着执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705389726815","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705389726815.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("编译过程如果无报错则继续往下走，有报错，则自行根据具体报错解决。")]),s._v(" "),a("h2",{attrs:{id:"_4-2-编译桌面程序-usbdesk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-编译桌面程序-usbdesk"}},[s._v("#")]),s._v(" 4.2 编译桌面程序 usbdesk")]),s._v(" "),a("p",[s._v("运行脚本前先看看路径，因为不同终端的编译路径可能会不一样。")]),s._v(" "),a("p",[s._v("这个是 "),a("code",[s._v("/data/tq_usb/usbdesktop/")]),s._v(" 目录下的 "),a("code",[s._v("run.sh")]),s._v(" 文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705386595330","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705386595330.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("在看看"),a("code",[s._v("/data/tq_usb/usbdesktop/")]),s._v(" 目录下的 "),a("code",[s._v("build.sh")]),s._v(" 文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705386997129","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705386997129.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("在看看"),a("code",[s._v("/data/tq_usb/usbdesktop/")]),s._v(" 目录下的 "),a("code",[s._v("CMakeList.txt")]),s._v(" 文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705651273840","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705651273840.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/usbdesktop/do_build")]),s._v(" 目录，运行 "),a("code",[s._v("build.sh")]),s._v(" 和 "),a("code",[s._v("run.sh")]),s._v(" 脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# usbdesktop 目录没有 do_build 目录就创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" do_build\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有的话就清空")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" *\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop/do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/build.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop/do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/run.sh\n\n./run.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("笔者这里运行 "),a("code",[s._v("build.sh")]),s._v(" 脚本是因为缺少了 qt5 的部分组件，所以报错了，有类似的朋友可以参考")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705387325407","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705387325407.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接命令行下载（前提是你的QT5也是用命令行下载的）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" qttools5-dev-tools\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有解决就把 多余的 QT安装包删了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" remove qttools5-dev-tools\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后你会看到他叫你可以删除多余的不需要的安装包，都删了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" autoremove\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后再重新下载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" qttools5-dev-tools\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("删除多余的安装包，如下图：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705389373449","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705389373449.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("编译成功，如下图：")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705389058070","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705389058070.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("然后接着继续编译源码，还是在 "),a("code",[s._v("do_build")]),s._v(" 目录执行 "),a("code",[s._v("make")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后在 "),a("code",[s._v("do_build")]),s._v(" 目录就生成了桌面程序 "),a("code",[s._v("usbdesk")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705389619953","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705389619953.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"_4-3-编译注册程序-power-reg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-编译注册程序-power-reg"}},[s._v("#")]),s._v(" 4.3 编译注册程序 power_reg")]),s._v(" "),a("p",[s._v("同样先进入脚本查看路径，因为这个是QT编写的程序，所以这里的脚本应该是以 "),a("code",[s._v(".pro")]),s._v(" 结尾的文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705390104544","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705390104544.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" prower_reg.pro\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705390193134","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705390193134.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("当然，图中的路径是已经注释了的，不改也可以，只是为了一致性。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/power_reg/do_build")]),s._v(" 目录，执行 "),a("code",[s._v("qmake ..")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# power_reg 目录没有 do_build 目录就创建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/power_reg/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" do_build\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有的话就清空")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" do_build "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" *\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\nqmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n---------------------如下：---------------------------------------------\nkylin@kylin:/data/tq_usb/power_reg/do_build$ qmake "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nInfo: creating stash "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /data/tq_usb/power_reg/do_build/.qmake.stash\nProject MESSAGE: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VAR_OS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kylin\nProject MESSAGE: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VAR_OS_VER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v10\nProject MESSAGE: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ARCH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x86_64\n------------------------------------------------------------------------\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-j8")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行完毕后就会在")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/tq_usb/release/x86_64/kylin-v10/bin 这个目录下生成 可执行文件 PowerReg")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h2",{attrs:{id:"_4-4-单机版本地运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-单机版本地运行"}},[s._v("#")]),s._v(" 4.4 单机版本地运行")]),s._v(" "),a("blockquote",[a("p",[s._v("项目源码编译通过再按下面步骤走")])]),s._v(" "),a("p",[s._v("进入 "),a("code",[s._v("/data/tq_usb/usbguard/src/DBus/")]),s._v(" 目录，将 "),a("code",[s._v("org.usbguard1.policy")]),s._v(" 文件中的所有 "),a("code",[s._v("auth_admin")]),s._v(" 该为 yes")]),s._v(" "),a("blockquote",[a("p",[s._v("这里介绍一个快捷的方式：vim 的手动批量替换（可以防止一键自动替换错地方）")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("首先，我们需要找到我们想要替换的文字。通过在普通模式下按"),a("code",[s._v("/")]),s._v("键并输入我们想要搜索的词语，Vim 就会高亮显示出所有文档中匹配该词语的地方，按下"),a("code",[s._v("Enter")]),s._v("键以确定搜索。")])]),s._v(" "),a("li",[a("p",[s._v("然后通过"),a("code",[s._v("n")]),s._v("和"),a("code",[s._v("N")]),s._v("键在搜索结果中向前和向后跳转。"),a("code",[s._v("n")]),s._v("键会将光标移动到下一个搜索结果，"),a("code",[s._v("N")]),s._v("键则会将光标移动到上一个搜索结果。")])]),s._v(" "),a("li",[a("p",[s._v("当我们找到了要替换的词语，我们可以通过"),a("code",[s._v("cw")]),s._v("命令将该词语替换为新的词语。在普通模式下，"),a("code",[s._v("cw")]),s._v("命令将删除从光标位置开始的词语，并进入插入模式，这允许我们输入新的词语。当我们完成新词语的输入后，通过按"),a("code",[s._v("Esc")]),s._v("键返回到普通模式。")])]),s._v(" "),a("li",[a("p",[s._v("如果我们想要重复上一步的替换操作，我们可以简单地通过"),a("code",[s._v(".")]),s._v("命令来实现。在普通模式下，"),a("code",[s._v(".")]),s._v("命令将重复最后一次修改，这也包括了我们的替换操作。")])]),s._v(" "),a("li",[a("p",[s._v("通过重复步骤 2 至 4，我们就可以实现对文档中所有匹配的词语的替换。")]),s._v(" "),a("p",[s._v("这就是在 Vim 中完成批量替换操作的步骤。尽管最开始可能会觉得有些复杂，但是一旦熟练掌握，你就会发现这实际上是一个非常快速和高效的替换方法。")])])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/src/DBus/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" org.usbguard1.policy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705394377574","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705394377574.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("例如：框框中的 auto_admin（不止这两个地方）改为 yes")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705394697922","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705394697922.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("/data/tq_usb/usbguard/src/DBus/org.usbguard1.policy")]),s._v(" 拷贝到 "),a("code",[s._v("/usr/share/polkit-1/actions/")])]),s._v(" "),a("p",[s._v("同时将 "),a("code",[s._v("/data/tq_usb/usbguard/src/DBus/org.usbguard1.conf")]),s._v(" 拷贝到  "),a("code",[s._v("/usr/share/dbus-1/system.d")]),s._v(" 下")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1704867038990","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1704867038990.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 /data/tq_usb/usbguard/src/DBus 目录下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/src/DBus\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" org.usbguard1.policy /usr/share/polkit-1/actions/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" org.usbguard1.conf /usr/share/dbus-1/system.d\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者是在 /usr/share/polkit-1/actions/ 目录下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/polkit-1/actions/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/usbguard/src/DBus/org.usbguard1.policy "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/share/dbus-1/system.d/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/usbguard/src/DBus/org.usbguard1.conf "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"_4-5-运行项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-运行项目"}},[s._v("#")]),s._v(" 4.5 运行项目")]),s._v(" "),a("blockquote",[a("p",[s._v("运行之前要初始化，不然开启项目后会把鼠标键盘全部禁用掉。")])]),s._v(" "),a("p",[s._v("把 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/etc")]),s._v(" 目录下的 usbguard 配置文件拷贝到 /etc 目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/etc/usbguard "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705395494488","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705395494488.webp",loading:"lazy"}})]),s._v(" "),a("h3",{attrs:{id:"_4-5-1-初始化项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-1-初始化项目"}},[s._v("#")]),s._v(" 4.5.1 初始化项目")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard generate-policy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /etc/usbguard/usbguard-daemon.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-5-2-运行项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-2-运行项目"}},[s._v("#")]),s._v(" 4.5.2 运行项目")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首先进入 do_build下的隐藏目录 .libs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbguard/do_build/.libs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard-daemon "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新开一个标签,返回 do_build 目录，执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./usbguard-dbus "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再新开一个标签，切换目录 /data/tq_usb/usbdesktop/do_build，执行 ../run.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/usbdesktop/do_build\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/run.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("在执行 "),a("code",[s._v("sudo ./usbguard-daemon")]),s._v(" 时出现找不到某个共享库"),a("img",{staticClass:"lazy",attrs:{alt:"1705395899224","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705395899224.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("要把 "),a("code",[s._v("/data/tq_usb/usbguard/do_build/.libs")]),s._v(" 目录和 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/lib")]),s._v(" 第三方库这两个路径加入到 "),a("code",[s._v("/etc/ld.so.conf.d/libc.conf")]),s._v(" 文件里")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/ld.so.conf.d/libc.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705397511285","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705397511285.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("运行 "),a("code",[s._v("./run.sh")]),s._v(" 脚本时出现以下错误，对 run.sh 脚本继续修改")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kylin@kylin:/data/tq_usb/usbdesktop/do_build$ ./run.sh\nterminate called after throwing an instance of "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'std::logic_error'")]),s._v("\n  what"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":  basic_string::_M_construct null not valid\n./run.sh：行 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("308527")]),s._v(" 已放弃               （核心已转储）./usbdesk "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" network "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /data/tq_usb/usbdesktop/etc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705399112769","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705399112769.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("可以通过查看上级目录的 main.cpp 文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/main.cpp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705399206948","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705399206948.webp",loading:"lazy"}})]),s._v(" "),a("h1",{attrs:{id:"_5-打包成安装包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-打包成安装包"}},[s._v("#")]),s._v(" 5. 打包成安装包")]),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/lib")]),s._v(" 整个目录 copy 到 "),a("code",[s._v("/data/tq_usb/make_package/res/lib")]),s._v("目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fr")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/lib/ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("hr"),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/sbin/usbguard-daemon")]),s._v(" 和 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/sbin/usbguard-dbus")]),s._v(" 两个文件 copy 到 "),a("code",[s._v("/data/tq_usb/make_package/res/bin/")]),s._v("目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/tq_usb/make_package/res/bin\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/sbin/usbguard-daemon "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/sbin/usbguard-dbus "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705391414379","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705391414379.webp",loading:"lazy"}})]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("/data/tq_usb/release/x86_64/kylin-v10/bin")]),s._v(" 目录下的 PowerReg、usbdesk、usbguard 三个文件\ncopy 到 "),a("code",[s._v("/data/tq_usb/make_package/res/bin")]),s._v(" 目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/bin/PowerReg "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/bin/usbdesk "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /data/tq_usb/release/x86_64/kylin-v10/bin/usbguard "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705393378879","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705393378879.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("到 "),a("code",[s._v("/data/tq_usb/make_package")]),s._v(" 目录下找到 "),a("code",[s._v("Packager.py")]),s._v(" 脚本执行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("./Packager.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("输入版本号, 就会自动生成deb安装包")]),s._v(" "),a("p",[s._v("第一次打包可能告诉你需要下载某个东西")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705393496704","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705393496704.webp",loading:"lazy"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" dh-make devscripts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("再次执行脚本")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705393858017","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705393858017.webp",loading:"lazy"}})]),s._v(" "),a("blockquote",[a("p",[s._v("不知道是不是 bug，这里要敲击 "),a("code",[s._v("ctrl+C")]),s._v(" 程序才会继续运行，不然就会一直卡在这里。")])]),s._v(" "),a("p",[s._v("安装完后的安装包就是一个以 "),a("code",[s._v(".deb")]),s._v(" 结尾的文件")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"1705393980638","data-src":"https://cdn.jsdelivr.net/gh/xiaose-code/Pictures@main/img/1705393980638.webp",loading:"lazy"}})]),s._v(" "),a("p",[s._v("安装这个包可以执行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" dpkg "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" com.tq.usbguard_2024.1.16_amd64.deb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"_6-安装过程注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-安装过程注意事项"}},[s._v("#")]),s._v(" 6. 安装过程注意事项")]),s._v(" "),a("ol",[a("li",[s._v("安装之前把所有的u盘拨出")]),s._v(" "),a("li",[s._v("插好USB接口的鼠标和键盘")]),s._v(" "),a("li",[s._v("开始安装")]),s._v(" "),a("li",[s._v("首次运行需要等待大约30秒再启动桌面程序")])])])}),[],!1,null,null,null);a.default=e.exports}}]);